<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Set Location</title>
    <style>
      body { font-family: sans-serif; margin: 20px; background: #f8f8f8; }
      label, input { display: block; margin-bottom: 10px; }
      #status { margin-top: 10px; height: 20px; }
      #check { color: green; font-size: 1.5em; display: none; }
      #error { color: red; display: none; }
      #container { text-align: center; }
      input { width: 90%; padding: 5px; }
      button { margin-top: 10px; padding: 5px 15px; }
    </style>
  </head>
  <body>
    <div id="container">
      <label for="location">Enter location (postcode/city,country):</label>
      <input id="location" type="text" autofocus />
      <button id="set">Set</button>
      <div id="status">
        <span id="check">âœ”</span>
        <span id="error">Location not recognized. Please try again.</span>
      </div>
    </div>
    <script>
      const { ipcRenderer } = require('electron');
      const axios = require('axios');
      const apiKey = '[REDACTED_API_KEY]'; // Use your OpenWeatherMap API key
      const setBtn = document.getElementById('set');
      const locInput = document.getElementById('location');
      const check = document.getElementById('check');
      const error = document.getElementById('error');
      setBtn.onclick = async () => {
        const loc = locInput.value.trim();
        check.style.display = 'none';
        error.style.display = 'none';
        if (!loc) return;
        // Validate location using OpenWeatherMap Geocoding API
        try {
          const geoResp = await axios.get(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(loc)}&limit=1&appid=${apiKey}`);
          if (geoResp.data && geoResp.data.length > 0) {
            check.style.display = 'inline';
            error.style.display = 'none';
            setTimeout(() => {
              ipcRenderer.send('set-location', loc);
            }, 500);
          } else {
            check.style.display = 'none';
            error.style.display = 'inline';
          }
        } catch (e) {
          check.style.display = 'none';
          error.style.display = 'inline';
        }
      };
      locInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') setBtn.click();
      });
    </script>
  </body>
</html>
